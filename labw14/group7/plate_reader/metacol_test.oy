argument
  cell_array_input: sample array, "Choose the 3 strains you would like to assay"
  #number_of_copies: int, "How many copies of each strain would you like? NOTE: max of 12 samples/assay"
  #induce_steps: int array, "input the desired induction times"
end

#induce_steps = [0, 1, 1.5, 2, 24]
#todo: sort induce_steps array here
#todo: check if first time is 0 (boolean zero_hour_induction)
#todo: check for negative numbers

#todo: check that there are at most 12 samples, and at most 8 induction steps. Quit or reboot if not true.

place initial_media
  protocol: "labw14/group7/plate_reader/prepare_media_4.pl"
  argument
    media_name: "400 mL M9 liquid Glucose"
    antibios: ["kan", "amp"]
    dilutions: [200, 500]
    total_volume: 40
  end
  group: aquarium_user
  start: now()
  window: minutes(10)
  marked: true
end

place glucose_grow
  protocol: "labw14/group7/plate_reader/glucose_grow.pl"
  argument
    plated_cells: cell_array_input
  end
  group: aquarium_user
  start: now()
  window: minutes(10)
end

place plate_reader_media_delay
  protocol: "labw14/group7/plate_reader/prepare_media_4.pl"
  argument
    media_name: "400 mL M9 liquid Glucose"
    antibios: ["kan", "amp"]
    dilutions: [200, 500]
    total_volume: 15
  end
  group: aquarium_user
  start: minutes(0.1)  #TODO: replace with 8 hour delay
  window: minutes(10)
end

place load_plate
  protocol: "labw14/group7/plate_reader/load_plate.pl"
  group: aquarium_user
  start: now()
  window: minutes(5)
end

place induce_zero
  protocol: "labw14/group7/plate_reader/induce_zero.pl"
  group: aquarium_user
  start: now()
  window: minutes(5)
end

place start_reader
  protocol: "labw14/group7/plate_reader/start_reader.pl"
  group: aquarium_user
  start: now()
  window: minutes(5)
end

wire (glucose_grow, "incubated_cells_id") => (load_plate,"cells_to_assay_in")

#initial_media => glucose_grow
transition [initial_media] => [glucose_grow] when !error(0) && completed(0) end
#initial_media rework
transition [initial_media] => [initial_media] when error(0) end

#glucose_grow => plate_reader_media_delay
transition [glucose_grow] => [plate_reader_media_delay] when !error(0) && completed(0) end
#glucose_grow rework
transition [glucose_grow] => [glucose_grow] when error(0) end

#plate_reader_media_delay rework  #TODO: avoid repeating delay
transition [plate_reader_media_delay] => [plate_reader_media_delay] when error(0) end
transition [plate_reader_media_delay] => [load_plate] when !error(0) && completed(0) end
transition [load_plate] => [load_plate] when error(0) end
transition [load_plate] => [induce_zero] when !error(0) && completed(0) end
transition [induce_zero] => [induce_zero] when error(0) end
transition [induce_zero] => [start_reader] when !error(0) && completed(0) end
transition [start_reader] => [start_reader] when error(0) end
